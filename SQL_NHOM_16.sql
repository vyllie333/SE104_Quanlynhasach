-- Tạo database
--DROP DATABASE quanlynhasach
GO
CREATE DATABASE quanlynhasach
GO
USE quanlynhasach
GO
SET DATEFORMAT DMY
-- Tạo bảng

CREATE TABLE [dbo].[PHANQUYEN](
	[MaPhanQuyen] [int] NOT NULL,
	[TenPhanQuyen] [nvarchar](100) NOT NULL,
	PRIMARY KEY CLUSTERED ([MaPhanQuyen])
);

GO
INSERT [dbo].[PhanQuyen] ([MaPhanQuyen], [TenPhanQuyen]) VALUES (1, N'Nhân viên')
INSERT [dbo].[PhanQuyen] ([MaPhanQuyen], [TenPhanQuyen]) VALUES (2, N'Quản lý')

GO
CREATE TABLE [dbo].[TAIKHOAN](
	[MaTaiKhoan] [int] NOT NULL,
	[Email] [varchar](100) NOT NULL,
	[MatKhau] [varchar](50) NOT NULL,
	[HoTen] [nvarchar](100) NOT NULL,
	[MaPhanQuyen] [int] NOT NULL,
    PRIMARY KEY CLUSTERED ([MaTaiKhoan])

)
GO
-- 3 tài khoản
INSERT [dbo].[TaiKhoan] ([MaTaiKhoan], [Email], [MatKhau], [HoTen], [MaPhanQuyen]) VALUES (1, N'quanly@uit', N'uit', N'Nguyễn Văn A', 2)
INSERT [dbo].[TaiKhoan] ([MaTaiKhoan], [Email], [MatKhau], [HoTen], [MaPhanQuyen]) VALUES (2, N'nhanvien1@uit', N'uit', N'Trần Thị B', 1)
INSERT [dbo].[TaiKhoan] ([MaTaiKhoan], [Email], [MatKhau], [HoTen], [MaPhanQuyen]) VALUES (3, N'nhanvien2@uit', N'uit', N'Ngô C', 1)




GO
CREATE TABLE [dbo].[PHIEUNHAP] (
    [MaPhieuNhap] INT  NOT NULL,
    [NgayNhap]    SMALLDATETIME NULL,
    PRIMARY KEY CLUSTERED ([MaPhieuNhap] ASC)
);
GO

INSERT INTO PHIEUNHAP VALUES (1,  '05/10/2022')
INSERT INTO PHIEUNHAP VALUES (2,  '12/10/2022')
INSERT INTO PHIEUNHAP VALUES (3,  '19/10/2022')
INSERT INTO PHIEUNHAP VALUES (4,  '26/10/2022')
INSERT INTO PHIEUNHAP VALUES (5,  '02/11/2022')
INSERT INTO PHIEUNHAP VALUES (6,  '09/01/2023')
INSERT INTO PHIEUNHAP VALUES (7,  '16/02/2023')
INSERT INTO PHIEUNHAP VALUES (8,  '23/03/2023')
INSERT INTO PHIEUNHAP VALUES (9,  '30/04/2023')
INSERT INTO PHIEUNHAP VALUES (10, '07/05/2023')

CREATE TABLE [dbo].[SACH] (
    [MaSach]     INT   NOT NULL,
    [TenSach]    NCHAR (100) NULL,
    [TheLoai]    NCHAR (50)  NULL,
    [TacGia]     NCHAR (50)  NULL,
    [SoLuongTon] INT         NULL,
    [DonGia]     FLOAT       NULL,
    PRIMARY KEY CLUSTERED ([MaSach] ASC)
);
GO
-- 50 sách
INSERT [dbo].[Sach] VALUES (1, N'Dế Mèn Phiêu Lưu Ký', N'Truyện thiếu nhi', N'Tô Hoài', 231, 30000)
INSERT [dbo].[Sach] VALUES (2, N'Dế Mèn Tốt Bụng', N'Truyện thiếu nhi', N'Tô Hoài', 303, 152000)
INSERT [dbo].[Sach] VALUES (3, N'Tôi Thấy Hoa Vàng Trên Cỏ Xanh', N'Tiểu thuyết', N'Nguyễn Nhật Ánh', 268, 100000)
INSERT [dbo].[Sach] VALUES (4, N'Cho Tôi Xin Một Vé Đi Tuổi Thơ', N'Tự truyện', N'Nguyễn Nhật Ánh', 120, 190000)
INSERT [dbo].[Sach] VALUES (5, N'Mắt Biếc', N'Tiểu thuyết', N'Nguyễn Nhật Ánh', 101, 171000)
INSERT [dbo].[Sach] VALUES (6, N'Kính Vạn Hoa', N'Tiểu thuyết', N'Nguyễn Nhật Ánh', 290, 140000)
INSERT [dbo].[Sach] VALUES (7, N'Bên Nhau Trọn Đời', N'Tiểu thuyết', N'Trương Hồng Ân', 342, 79000)
INSERT [dbo].[Sach] VALUES (8, N'Số Đỏ', N'Tiểu thuyết', N'Vũ Trọng Phụng', 401, 109000)
INSERT [dbo].[Sach] VALUES (9, N'Những Ngày Thứ Bảy',N'Tiểu thuyết' , N'Vũ Trọng Phụng', 301, 126000)
INSERT [dbo].[Sach] VALUES (10, N'Truyện Kiều', N'Thơ', N'Nguyễn Du', 349, 140000)
INSERT [dbo].[Sach] VALUES (11, N'Tắt Đèn', N'Tiểu thuyết', N'Ngô Tất Tố', 410, 209000)
INSERT [dbo].[Sach] VALUES (12, N'Còn Lại Hạnh Phúc', N'Tâm lý', N'Nguyễn Ngọc Thuần', 350, 230000)
INSERT [dbo].[Sach] VALUES (13, N'Lão Hạc', N'Tiểu thuyết', N'Nam Cao', 201, 200000)
INSERT [dbo].[Sach] VALUES (14, N'Người Trong Bao', N'Tiểu thuyết', N'Nguyễn Huy Thiệp', 310, 220000)
INSERT [dbo].[Sach] VALUES (15, N'The Diary of a Young Girl', N'Hồi ký', N'Anne Frank', 100, 300000)
INSERT [dbo].[Sach] VALUES (16, N'Thám tử lừng danh Conan: Quả bom chọc trời', N'Trinh thám', N'Aoyama Gosho', 240, 98000)
INSERT [dbo].[Sach] VALUES (17, N'Thám tử lừng danh Conan: Mục tiêu thứ 14', N'Trinh thám', N'Aoyama Gosho', 111, 98000)
INSERT [dbo].[Sach] VALUES (18, N'Thám tử lừng danh Conan: Ảo thuật gia cuối cùng của thế kỷ', N'Trinh thám', N'Aoyama Gosho', 369, 98000)
INSERT [dbo].[Sach] VALUES (19, N'Thám tử lừng danh Conan: Thủ phạm trong đôi mắt', N'Trinh thám', N'Aoyama Gosho', 321, 98000)
INSERT [dbo].[Sach] VALUES (20, N'Thám tử lừng danh Conan: Những giây cuối cùng tới thiên đường', N'Trinh thám', N'Aoyama Gosho', 210, 100000)
INSERT [dbo].[Sach] VALUES (21, N'Thám tử lừng danh Conan: Bóng ma đường Baker', N'Trinh thám', N'Aoyama Gosho', 40, 100000)
INSERT [dbo].[Sach] VALUES (22, N'Thám tử lừng danh Conan: Mê cung trong thành phố cổ', N'Trinh thám', N'Aoyama Gosho', 246, 100000)
INSERT [dbo].[Sach] VALUES (23, N'Thám tử lừng danh Conan: Nhà ảo thuật với đôi cánh bạc', N'Trinh thám', N'Aoyama Gosho', 329, 100000)
INSERT [dbo].[Sach] VALUES (24, N'Thám tử lừng danh Conan: Âm mưu trên biển', N'Trinh thám', N'Aoyama Gosho', 265, 100000)
INSERT [dbo].[Sach] VALUES (25, N'Thám tử lừng danh Conan: Lễ cầu hồn của thám tử', N'Trinh thám', N'Aoyama Gosho', 312, 100000)
INSERT [dbo].[Sach] VALUES (26, N'Doraemon: Nobita và chuyến phiêu lưu vào xứ quỷ', N'Thiếu Nhi', N'Fujiko F. Fujio', 123, 20000)
INSERT [dbo].[Sach] VALUES (27, N'Doraemon: Nobita ở xứ sở nghìn lẻ một đêm', N'Thiếu Nhi', N'Fujiko F. Fujio', 213, 20000)
INSERT [dbo].[Sach] VALUES (28, N'Doraemon: Nobita và người khổng lồ xanh', N'Thiếu Nhi', N'Fujiko F. Fujio', 135, 20000)
INSERT [dbo].[Sach] VALUES (29, N'Doraemon: Nobita và cuộc đại thủy chiến ở xứ sở người cá', N'Thiếu Nhi', N'Fujiko F. Fujio', 147, 20000)
INSERT [dbo].[Sach] VALUES (30, N'Doraemon: Chú khủng long của Nobita', N'Thiếu Nhi', N'Fujiko F. Fujio', 194, 20000)
INSERT [dbo].[Sach] VALUES (31, N'Doraemon: Vương quốc trên mây', N'Thiếu Nhi', N'Fujiko F. Fujio', 352, 22000)
INSERT [dbo].[Sach] VALUES (32, N'Doraemon: Ba chàng hiệp sĩ mộng mơ', N'Thiếu Nhi', N'Fujiko F. Fujio', 341, 22000)
INSERT [dbo].[Sach] VALUES (33, N'Doraemon: Lạc vào thế giới côn trùng', N'Thiếu Nhi', N'Fujiko F. Fujio', 168, 22000)
INSERT [dbo].[Sach] VALUES (34, N'Doraemon: Hành trình qua dải ngân hà', N'Thiếu Nhi', N'Fujiko F. Fujio', 248, 22000)
INSERT [dbo].[Sach] VALUES (35, N'Doraemon: Truyền thuyết về vua mặt trời Nobita', N'Thiếu Nhi', N'Fujiko F. Fujio', 299, 22000)
INSERT [dbo].[Sach] VALUES (36, N'Lược sử thời gian', N'Vật lý, khoa học tự nhiên, Triết học', N'Stephen Hawking', 69, 220000)
INSERT [dbo].[Sach] VALUES (37, N'Vũ trụ trong vỏ hạt dẻ', N'Vật lý, khoa học tự nhiên, Triết học', N'Stephen Hawking', 90, 200000)
INSERT [dbo].[Sach] VALUES (38, N'Chìa khóa vũ trụ của George', N'Vật lý, khoa học tự nhiên, Triết học', N'Stephen Hawking', 368, 242000)
INSERT [dbo].[Sach] VALUES (39, N'Lý thuyết về tất cả mọi thứ', N'Vật lý, khoa học tự nhiên, Triết học', N'Stephen Hawking', 125, 250000)
INSERT [dbo].[Sach] VALUES (40, N'Lược sử của tôi', N'Vật lý, khoa học tự nhiên, Triết học', N'Stephen Hawking', 229, 272000)
INSERT [dbo].[Sach] VALUES (41, N'Bản thiết kế vĩ đại', N'Vật lý, khoa học tự nhiên, Triết học', N'Stephen Hawking', 265, 258000)
INSERT [dbo].[Sach] VALUES (42, N'Trả lời ngắn gọn những câu hỏi lớn', N'Vật lý, khoa học tự nhiên, Triết học', N'Stephen Hawking', 399, 298000)
INSERT [dbo].[Sach] VALUES (43, N'Lược sử thời gian', N'Vật lý, khoa học tự nhiên, Triết học', N'Stephen Hawking', 349, 299000)
INSERT [dbo].[Sach] VALUES (44, N'Trạng Quỷnh: Đại ca xóm giếng', N'Thiếu nhi', N'Kim Khánh', 219, 16000)
INSERT [dbo].[Sach] VALUES (45, N'Trạng Quỷnh: Vớt của chìm', N'Thiếu nhi', N'Kim Khánh', 369, 16000)
INSERT [dbo].[Sach] VALUES (46, N'Trạng Quỷnh: Con dao gia truyền', N'Thiếu nhi', N'Kim Khánh', 232, 16000)
INSERT [dbo].[Sach] VALUES (47, N'Trạng Quỷnh: Kho báu của người ta', N'Thiếu nhi', N'Kim Khánh', 390, 18000)
INSERT [dbo].[Sach] VALUES (48, N'Trạng Quỷnh: Con nhỏ giàu', N'Thiếu nhi', N'Kim Khánh', 314, 18000)
INSERT [dbo].[Sach] VALUES (49, N'Trạng Quỷnh: Thuốc trường sinh', N'Thiếu nhi', N'Kim Khánh', 138, 20000)
INSERT [dbo].[Sach] VALUES (50, N'Trạng Quỷnh: Kẻ thù biến mất', N'Thiếu nhi', N'Kim Khánh', 415, 20000)

CREATE TABLE [dbo].[CHITIETPHIEUNHAP] (
    [MaChiTietPhieuNhap] INT NOT NULL,
    [MaPhieuNhap]        INT NOT NULL,
    [MaSach]             INT NOT NULL,
    [SoLuongNhap]        INT       NULL,
    PRIMARY KEY CLUSTERED ([MaChiTietPhieuNhap] ASC),
    CONSTRAINT [FK_MaPhieuNhap_CTPN_PHIEUNHAP] FOREIGN KEY ([MaPhieuNhap]) REFERENCES [dbo].[PHIEUNHAP] ([MaPhieuNhap]),
    CONSTRAINT [FK_MaSach_CTPN_SACH] FOREIGN KEY ([MaSach]) REFERENCES [dbo].[SACH] ([MaSach])
);
GO
--50 CTPN
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (1, 2, 1, 150)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (2, 3, 2, 175)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (3, 1, 4, 40)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (4, 7, 6, 300)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (5, 6, 7, 132)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (6, 9, 5, 189)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (7, 8, 9, 167)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (8, 4, 10, 230)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (9, 2, 11, 221)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (10, 3, 8, 165)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (11, 4, 3, 149)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (12, 5, 16, 190)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (13, 8, 17, 184)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (14, 9, 13, 201)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (15, 10, 12, 210)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (16, 2, 14, 270)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (17, 3, 21, 231)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (18, 1, 22, 178)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (19, 3, 23, 123)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (20, 4, 15, 161)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (21, 2, 31, 310)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (22, 3, 39, 213)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (23, 1, 32, 231)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (24, 6, 41, 261)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (25, 7, 50, 289)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (26, 8, 42, 278)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (27, 10, 30, 195)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (28, 3, 18, 100)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (29, 4, 46, 231)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (30, 5, 20, 232)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (31, 6, 45, 211)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (32, 2, 34, 211)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (33, 3, 40, 289)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (34, 10, 25, 236)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (35, 2, 19, 246)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (36, 3, 24, 279)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (37, 5, 36, 248)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (38, 6, 48, 248)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (39, 7, 49, 289)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (40, 1, 37, 248)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (41, 3, 33, 222)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (42, 6, 29, 159)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (43, 10, 44, 151)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (44, 7, 26, 150)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (45, 3, 43, 141)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (46, 9, 47, 176)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (47, 3, 27, 189)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (48, 4, 38, 159)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (49, 7, 28, 124)
INSERT [dbo].[CHITIETPHIEUNHAP] VALUES (50, 8, 35, 266)

GO
CREATE TABLE [dbo].[KHACHHANG] (
    [MaKhachHang]   INT   NOT NULL,
    [HoTenKhachHang] nvarchar (50)  NULL,
    [DiaChi]         nvarchar (100) NULL,
    [DienThoai]      nvarchar  (15) NULL,
    [Email]          varchar (20)   NULL,
    [SoTienNo]       FLOAT       NULL,
    PRIMARY KEY CLUSTERED ([MaKhachHang] ASC)
);
GO
-- 15 khách hàng
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (1, N'Nguyễn Văn Linh', 200000, N'Hoàng Diệu 2', N'0913412412', N'vanlinh@uit.edu.vn')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (2, N'Huỳnh Chí Phong', 12000, N'đường Kha Vạn Cân', N'01203875665', N'phong123@gmail.com')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (3, N'Nguyễn Hà Vy', 10000, N'Đường số 1', N'0893211312', N'havy123@uit.edu.vn')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (4, N'Phạm Huỳnh Phát', 1200000, N'Nam Kỳ Khởi Nghĩa', N'0324718281', N'phat123@gmail.com')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (5, N'Nguyễn Việt Thành', 10000000, N'Pasteur', N'0912314122', N'thanhnv1@uit.edu.vn')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (6, N'Lê Thị Trà My', 2000000, N'Trương Công Định', N'0412875625', N'tramie12@gmail.com')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (7, N'Trần Thị Lan Anh', 30000, N'Trương Văn Bang', N'0982323127', N'lanh03@uit.edu.vn')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (8, N'Phan Chí Vỹ', 10000, N'Võ Văn Ngân', N'0567123318', N'vycr7gmail.com')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (9, N'Mai Phúc Thành', 200000, N'Lê Hồng Phong', N'0412671281', N'lpt123@uit.edu.vn')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (10, N'Hồ Ngọc Hà', 120000, N'Cách Mạng Tháng Tám', N'0791231265', N'hnh213@gmail.com')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (11, N'Đặng Văn Tài', 40000, N'Thống Nhất', N'01267418123', N'taidang1@uit.edu.vn')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (12, N'Hà Thị Quỳnh', 50000, N'Đặng Văn Bi', N'0471712219', N'htquynh412@gmail.com')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (13, N'Trương Ngọc Quỳnh Như', 3000000, N'Nguyễn Huệ', N'0901212142', N'nhu123@uit.edu.vn')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (14, N'Đỗ Văn Sơn', 70000, N'Võ Nguyên Giáp', N'0321819192', N'dson122@gmail.com')
INSERT [dbo].[KhachHang] ([MaKhachHang], [HoTenKhachHang], [SoTienNo], [DiaChi], [DienThoai], [Email]) VALUES (15, N'Trần Đăng Khoa', 2000, N'Phạm Văn Đồng', N'01237122198', N'tdk123@uit.edu.vn')


CREATE TABLE [dbo].[PHIEUHOADON] (
    [MaPhieuHoaDon] INT     NOT NULL,
    [MaKhachHang]   INT     NOT NULL,
    [NgayLapHoaDon] SMALLDATETIME NULL,
    PRIMARY KEY CLUSTERED ([MaPhieuHoaDon] ASC),
    CONSTRAINT [FK_MaKhachHang_PHD_KHACHHANG] FOREIGN KEY ([MaKhachHang]) REFERENCES [dbo].[KHACHHANG] ([MaKhachHang])
);


INSERT INTO PHIEUHOADON VALUES (1, 1, '01/06/2022')
INSERT INTO PHIEUHOADON VALUES (2, 2, '30/08/2022')
INSERT INTO PHIEUHOADON VALUES (3, 3, '04/09/2022')
INSERT INTO PHIEUHOADON VALUES (4, 4, '15/10/2022')
INSERT INTO PHIEUHOADON VALUES (5, 5, '12/11/2022')
INSERT INTO PHIEUHOADON VALUES (6, 6, '31/12/2022')
INSERT INTO PHIEUHOADON VALUES (7, 7, '30/01/2023')
INSERT INTO PHIEUHOADON VALUES (8, 8, '01/02/2023')
INSERT INTO PHIEUHOADON VALUES (9, 9, '12/02/2023')
INSERT INTO PHIEUHOADON VALUES (10, 10, '14/02/2023')
INSERT INTO PHIEUHOADON VALUES (11, 11, '08/03/2023')
INSERT INTO PHIEUHOADON VALUES (12, 12, '10/03/2023')
INSERT INTO PHIEUHOADON VALUES (13, 13, '21/03/2023')
INSERT INTO PHIEUHOADON VALUES (14, 14, '29/03/2023')
INSERT INTO PHIEUHOADON VALUES (15, 15, '05/04/2023')

CREATE TABLE [dbo].[CHITIETPHIEUHOADON] (
    [MaChiTietPhieuHoaDon] INT NOT NULL,
    [MaPhieuHoaDon]        INT NOT NULL,
    [MaSach]               INT NOT NULL,
    [SoLuongBan]           INT       NULL,
    PRIMARY KEY CLUSTERED ([MaChiTietPhieuHoaDon] ASC),
    CONSTRAINT [FK_MaPhieuHoaDon_CTPHD_PHIEUHOADON] FOREIGN KEY ([MaPhieuHoaDon]) REFERENCES [dbo].[PHIEUHOADON] ([MaPhieuHoaDon]),
    CONSTRAINT [FK_MaSach_CTPHD_SACH] FOREIGN KEY ([MaSach]) REFERENCES [dbo].[SACH] ([MaSach])
);
GO

-- 20 CTPHD
INSERT INTO CHITIETPHIEUHOADON VALUES (1, 4, 20, 100)
INSERT INTO CHITIETPHIEUHOADON VALUES (2, 5, 23, 120)
INSERT INTO CHITIETPHIEUHOADON VALUES (3, 3, 24, 124)
INSERT INTO CHITIETPHIEUHOADON VALUES (4, 15, 45, 122)
INSERT INTO CHITIETPHIEUHOADON VALUES (5, 1, 50, 155)
INSERT INTO CHITIETPHIEUHOADON VALUES (6, 10, 9, 290)
INSERT INTO CHITIETPHIEUHOADON VALUES (7, 12, 10, 136)
INSERT INTO CHITIETPHIEUHOADON VALUES (8, 2, 13, 182)
INSERT INTO CHITIETPHIEUHOADON VALUES (9, 7, 30, 102)
INSERT INTO CHITIETPHIEUHOADON VALUES (10, 6, 43, 172)
INSERT INTO CHITIETPHIEUHOADON VALUES (11, 4, 12, 145)
INSERT INTO CHITIETPHIEUHOADON VALUES (12, 5, 7, 331)
INSERT INTO CHITIETPHIEUHOADON VALUES (13, 11, 5, 100)
INSERT INTO CHITIETPHIEUHOADON VALUES (14, 13, 3, 256)
INSERT INTO CHITIETPHIEUHOADON VALUES (15, 14, 1, 135)
INSERT INTO CHITIETPHIEUHOADON VALUES (16, 9, 39, 160)
INSERT INTO CHITIETPHIEUHOADON VALUES (17, 8, 38, 167)
INSERT INTO CHITIETPHIEUHOADON VALUES (18, 2, 31, 189)
INSERT INTO CHITIETPHIEUHOADON VALUES (19, 3, 33, 112)
INSERT INTO CHITIETPHIEUHOADON VALUES (20, 1, 44, 110)



CREATE TABLE [dbo].[PHIEUTHUTIEN] (
    [MaPhieuThu]  INT     NOT NULL,
    [SoTienThu]   FLOAT         NULL,
    [NgayThuTien] SMALLDATETIME NULL,
    [MaKhachHang] INT     NOT NULL,
    PRIMARY KEY CLUSTERED ([MaPhieuThu] ASC),
    CONSTRAINT [FK_MaKhachHang_PTT_KHACHHANG] FOREIGN KEY ([MaKhachHang]) REFERENCES [dbo].[KHACHHANG] ([MaKhachHang])
);
GO
-- 10 Phiếu thu tiền
INSERT INTO PHIEUTHUTIEN VALUES (1, 25000, '04/10/2022', 1)
INSERT INTO PHIEUTHUTIEN VALUES (2, 10000, '12/11/2022', 2)
INSERT INTO PHIEUTHUTIEN VALUES (3, 250000, '15/12/2022', 3)
INSERT INTO PHIEUTHUTIEN VALUES (4, 1300000, '08/01/2023', 4)
INSERT INTO PHIEUTHUTIEN VALUES (5, 300000, '09/01/2023', 5)
INSERT INTO PHIEUTHUTIEN VALUES (6, 45000, '04/02/2023', 6)
INSERT INTO PHIEUTHUTIEN VALUES (7, 5000, '03/03/2023', 7)
INSERT INTO PHIEUTHUTIEN VALUES (8, 400000, '25/03/2023', 8)
INSERT INTO PHIEUTHUTIEN VALUES (9, 500000, '14/04/2023', 9)
INSERT INTO PHIEUTHUTIEN VALUES (10, 30000, '06/05/2023', 10)
CREATE TABLE [dbo].[BAOCAOTON] (
    [MaChiTietTon] INT		 NOT NULL,
    [Thang]        INT       NULL,
	[Nam]		   INT		 NULL,
    [MaSach]       INT		 NOT NULL,
    [TonDau]       INT       NULL,
    [TonPhatSinh]  INT       NULL,
    [TonCuoi]      INT       NULL,
    PRIMARY KEY CLUSTERED ([MaChiTietTon] ASC),
    CONSTRAINT [FK_MaSach_BCT_SACH] FOREIGN KEY ([MaSach]) REFERENCES [dbo].[SACH] ([MaSach])
);
GO
-- 200 BAO CAO TON cho 50 sách
INSERT INTO BAOCAOTON VALUES (1, 1, 2006, 1, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (2, 2, 2006, 2, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (3, 3, 2006, 3, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (4, 4, 2006, 4, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (5, 5, 2006, 5, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (6, 6, 2006, 6, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (7, 7, 2006, 7, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (8, 8, 2006, 8, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (9, 9, 2006, 9, 84, 47, 131)
INSERT INTO BAOCAOTON VALUES (10, 10, 2006, 10, 65, 145, 210)
INSERT INTO BAOCAOTON VALUES (11, 11, 2006, 11, 35, 222, 258)
INSERT INTO BAOCAOTON VALUES (12, 12, 2006, 12, 67, 167, 234)
INSERT INTO BAOCAOTON VALUES (13, 1, 2007, 13, 103, 55, 158)
INSERT INTO BAOCAOTON VALUES (14, 2, 2007, 14, 123, 174, 297)
INSERT INTO BAOCAOTON VALUES (15, 3, 2007, 15, 118, 120, 238)
INSERT INTO BAOCAOTON VALUES (16, 4, 2007, 16, 123, 70, 193)
INSERT INTO BAOCAOTON VALUES (17, 5, 2007, 17, 86, 170, 256)
INSERT INTO BAOCAOTON VALUES (18, 6, 2007, 18, 36, 132, 168)
INSERT INTO BAOCAOTON VALUES (19, 7, 2007, 19, 138, 65, 203)
INSERT INTO BAOCAOTON VALUES (20, 8, 2007, 20, 45, 142, 187)
INSERT INTO BAOCAOTON VALUES (21, 9, 2007, 21, 33, 214, 247)
INSERT INTO BAOCAOTON VALUES (22, 10, 2007, 22, 56, 146, 202)
INSERT INTO BAOCAOTON VALUES (23, 11, 2007, 23, 103, 51, 154)
INSERT INTO BAOCAOTON VALUES (24, 12, 2007, 24, 55, 123, 178)
INSERT INTO BAOCAOTON VALUES (25, 1, 2008, 25, 140, 122, 262)
INSERT INTO BAOCAOTON VALUES (26, 2, 2008, 26, 131, 69, 200)
INSERT INTO BAOCAOTON VALUES (27, 3, 2008, 27, 39, 70, 109)
INSERT INTO BAOCAOTON VALUES (28, 4, 2008, 28, 50, 159, 209)
INSERT INTO BAOCAOTON VALUES (29, 5, 2008, 29, 90, 78, 168)
INSERT INTO BAOCAOTON VALUES (30, 6, 2008, 30, 31, 153, 184)
INSERT INTO BAOCAOTON VALUES (31, 7, 2008, 31, 56, 234, 390)
INSERT INTO BAOCAOTON VALUES (32, 8, 2008, 32, 83, 147, 230)
INSERT INTO BAOCAOTON VALUES (33, 9, 2008, 33, 104, 56, 160)
INSERT INTO BAOCAOTON VALUES (34, 10, 2008, 34, 58, 100, 258)
INSERT INTO BAOCAOTON VALUES (35, 11, 2008, 35, 119, 125, 244)
INSERT INTO BAOCAOTON VALUES (36, 12, 2008, 36, 122, 62, 184)
INSERT INTO BAOCAOTON VALUES (37, 1, 2009, 37, 82, 175, 257)
INSERT INTO BAOCAOTON VALUES (38, 2, 2009, 38, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (39, 3, 2009, 39, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (40, 4, 2009, 40, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (41, 5, 2009, 41, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (42, 6, 2009, 42, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (43, 7, 2009, 43, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (44, 8, 2009, 44, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (45, 9, 2009, 45, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (46, 11, 2009, 46, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (47, 12, 2009, 47, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (48, 1, 2010, 48, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (49, 2, 2010, 49, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (50, 3, 2010, 50, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (51, 4, 2010, 1, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (52, 5, 2010, 2, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (53, 6, 2010, 3, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (54, 7, 2010, 4, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (55, 8, 2010, 5, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (56, 9, 2010, 6, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (57, 10, 2010, 7, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (58, 11, 2010, 8, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (59, 12, 2010, 9, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (60, 1, 2011, 10, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (61, 2, 2011, 11, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (62, 3, 2011, 12, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (63, 4, 2011, 13, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (64, 5, 2011, 14, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (65, 6, 2011, 15, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (66, 7, 2011, 16, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (67, 8, 2011, 17, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (68, 9, 2011, 18, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (69, 10, 2011, 19, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (70, 11, 2011, 20, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (71, 12, 2011, 21, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (72, 1, 2012, 22, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (73, 2, 2012, 23, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (74, 3, 2012, 24, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (75, 4, 2012, 25, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (76, 5, 2012, 26, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (77, 6, 2012, 27, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (78, 7, 2012, 28, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (79, 8, 2012, 29, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (80, 9, 2012, 30, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (81, 10, 2012, 31, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (82, 11, 2012, 32, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (83, 12, 2012, 33, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (84, 1, 2013, 34, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (85, 2, 2013, 35, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (86, 3, 2013, 36, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (87, 4, 2013, 37, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (88, 5, 2013, 38, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (89, 6, 2013, 39, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (90, 7, 2013, 40, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (91, 8, 2013, 41, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (92, 9, 2013, 42, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (93, 10, 2013, 43, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (94, 11, 2013, 44, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (95, 12, 2013, 45, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (96, 1, 2014, 46, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (97, 2, 2014, 47, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (98, 3, 2014, 48, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (99, 4, 2014, 49, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (100, 5, 2014, 50, 50, 152, 178)
INSERT INTO BAOCAOTON VALUES (101, 6, 2014, 1 ,34, 234, 268)
INSERT INTO BAOCAOTON VALUES (102, 7, 2014, 2, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (103, 8, 2014, 3, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (104, 9, 2014, 4, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (105, 10, 2014, 5, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (106, 11, 2014, 6, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (107, 12, 2014, 7, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (108, 1, 2015, 8, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (109, 2, 2015, 9, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (110, 3, 2015, 10, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (111, 4, 2015, 11, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (112, 5, 2015, 12, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (113, 6, 2015, 13, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (114, 7, 2015, 14, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (115, 8, 2015, 15, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (116, 9, 2015, 16, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (117, 10, 2015, 17, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (118, 11, 2015, 18, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (119, 12, 2015, 19, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (120, 1, 2016, 20, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (121, 2, 2016, 21, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (122, 3, 2016, 22, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (123, 4, 2016, 23, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (124, 5, 2016, 24, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (125, 6, 2016, 25, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (126, 7, 2016, 26, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (127, 8, 2016, 27, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (128, 9, 2016, 28, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (129, 10, 2016, 29, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (130, 11, 2016, 30, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (131, 12, 2016, 31, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (132, 1, 2017, 32, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (133, 2, 2017, 33, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (134, 3, 2017, 34, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (135, 4, 2017, 35, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (136, 5, 2017, 36, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (137, 6, 2017, 37, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (138, 7, 2017, 38, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (139, 8, 2017, 39, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (140, 9, 2017, 40, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (141, 10, 2017, 41, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (142, 11, 2017, 42, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (143, 12, 2017, 43, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (144, 1, 2018, 44, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (145, 2, 2018, 45, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (146, 3, 2018, 46, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (147, 4, 2018, 47, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (148, 5, 2018, 48, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (149, 6, 2018, 49, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (150, 7, 2018, 50, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (151, 8, 2018, 1, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (152, 9, 2018, 2, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (153, 10, 2018, 3, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (154, 11, 2018, 4, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (155, 12, 2018, 5, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (156, 1, 2019, 6, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (157, 2, 2019, 7, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (158, 3, 2019, 8, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (159, 4, 2019, 9, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (160, 5, 2019, 10, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (161, 6, 2019, 11, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (162, 7, 2019, 12, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (163, 8, 2019, 13, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (164, 9, 2019, 14, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (165, 10, 2019, 15, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (166, 11, 2019, 16, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (167, 12, 2019, 17, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (168, 1, 2020, 18, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (169, 2, 2020, 19, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (170, 3, 2020, 20, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (171, 4, 2020, 21, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (172, 5, 2020, 22, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (173, 6, 2020, 23, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (174, 7, 2020, 24, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (175, 8, 2020, 25, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (176, 9, 2020, 26, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (177, 10, 2020, 27, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (178, 11, 2020, 28, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (179, 12, 2020, 29, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (180, 1, 2021, 30, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (181, 2, 2021, 31, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (182, 3, 2021, 32, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (183, 4, 2021, 33, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (184, 5, 2021, 34, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (185, 6, 2021, 35, 119, 121, 240)
INSERT INTO BAOCAOTON VALUES (186, 7, 2021, 36, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (187, 8, 2021, 37, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (188, 9, 2021, 38, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (189, 10, 2021, 39, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (190, 11, 2021, 40, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (191, 12, 2021, 41, 34, 234, 268)
INSERT INTO BAOCAOTON VALUES (192, 1, 2022, 42, 81, 147, 228)
INSERT INTO BAOCAOTON VALUES (193, 6, 2022, 43, 104, 52, 156)
INSERT INTO BAOCAOTON VALUES (194, 8, 2022, 44, 54, 173, 227)
INSERT INTO BAOCAOTON VALUES (195, 12, 2022, 45, 125, 126, 251)
INSERT INTO BAOCAOTON VALUES (196, 1, 2023, 46, 125, 69, 194)
INSERT INTO BAOCAOTON VALUES (197, 2, 2023, 47, 88, 75, 163)
INSERT INTO BAOCAOTON VALUES (198, 3, 2023, 48, 26, 152, 178)
INSERT INTO BAOCAOTON VALUES (199, 4, 2023, 49, 89, 73, 162)
INSERT INTO BAOCAOTON VALUES (200, 5, 2023, 50, 26, 153, 179)
GO
CREATE TABLE [dbo].[BAOCAOCONGNO] (
    [MaChiTietCongNo] INT NOT NULL,
    [Thang]           INT       NULL,
	[Nam]			  INT		NULL,
    [MaKhachHang]     INT NOT NULL,
    [NoDau]           INT       NULL,
    [NoPhatSinh]      INT       NULL,
    [NoCuoi]          INT       NULL,
    PRIMARY KEY CLUSTERED ([MaChiTietCongNo] ASC),
    CONSTRAINT [FK_MaKhachHang_BCCN_KHACHHANG] FOREIGN KEY ([MaKhachHang]) REFERENCES [dbo].[KHACHHANG] ([MaKhachHang])
);
GO
-- 50 BÁO CÁO CÔNG NỢ
INSERT INTO BAOCAOCONGNO VALUES (1, 1, 2019, 1, 19000, 13000, 32000)
INSERT INTO BAOCAOCONGNO VALUES (2, 2, 2019, 2, 8000, -1000, 7000)
INSERT INTO BAOCAOCONGNO VALUES (3, 3, 2019, 3, 18000, 2000, 20000)
INSERT INTO BAOCAOCONGNO VALUES (4, 4, 2019, 4, 30000, -10000, 20000)
INSERT INTO BAOCAOCONGNO VALUES (5, 5, 2019, 5, 190000, 3000, 193000)
INSERT INTO BAOCAOCONGNO VALUES (6, 6, 2019, 6, 5000, -1000, 4000)
INSERT INTO BAOCAOCONGNO VALUES (7, 7, 2019, 7, 41000, 56000, 97000)
INSERT INTO BAOCAOCONGNO VALUES (8, 8, 2019, 8, 32000, -15000, 17000)
INSERT INTO BAOCAOCONGNO VALUES (9, 9, 2019, 9, 33000, 13000, 46000)
INSERT INTO BAOCAOCONGNO VALUES (10, 10, 2019, 10, 90000, -1000, 89000)
INSERT INTO BAOCAOCONGNO VALUES (11, 11, 2019, 11, 312000, 300000, 612000)
INSERT INTO BAOCAOCONGNO VALUES (12, 12, 2019, 12, 80000, -1000, 79000)
INSERT INTO BAOCAOCONGNO VALUES (13, 1, 2020, 13, 32000, 100000, 132000)
INSERT INTO BAOCAOCONGNO VALUES (14, 2, 2020, 14, 23000, -22000, 1000)
INSERT INTO BAOCAOCONGNO VALUES (15, 3, 2020, 15, 36000, 14000, 50000)
INSERT INTO BAOCAOCONGNO VALUES (16, 4, 2020, 1, 85000, -15000, 70000)
INSERT INTO BAOCAOCONGNO VALUES (17, 5, 2020, 2, 15000, 15000, 30000)
INSERT INTO BAOCAOCONGNO VALUES (18, 6, 2020, 3, 320000, -100000, 220000)
INSERT INTO BAOCAOCONGNO VALUES (19, 7, 2020, 4, 122000, 32000, 154000)
INSERT INTO BAOCAOCONGNO VALUES (20, 8, 2020, 5, 244000, -100000, 144000)
INSERT INTO BAOCAOCONGNO VALUES (21, 9, 2020, 6, 232000, 132000, 364000)
INSERT INTO BAOCAOCONGNO VALUES (22, 10, 2020, 7, 500000, -120000, 380000)
INSERT INTO BAOCAOCONGNO VALUES (23, 11, 2020, 8, 600000, 150000, 750000)
INSERT INTO BAOCAOCONGNO VALUES (24, 12, 2020, 9, 321000, -21000, 300000)
INSERT INTO BAOCAOCONGNO VALUES (25, 1, 2021, 10, 511000, 39000, 550000)
INSERT INTO BAOCAOCONGNO VALUES (26, 2, 2021, 11, 123000, -12000, 111000)
INSERT INTO BAOCAOCONGNO VALUES (27, 3, 2021, 12, 34000, 15000, 49000)
INSERT INTO BAOCAOCONGNO VALUES (28, 4, 2021, 13, 322000, -50000, 272000)
INSERT INTO BAOCAOCONGNO VALUES (29, 5, 2021, 14, 412000, 13000, 425000)
INSERT INTO BAOCAOCONGNO VALUES (30, 6, 2021, 15, 80000, -20000, 60000)
INSERT INTO BAOCAOCONGNO VALUES (31, 7, 2021, 1, 1900, 13000, 14900)
INSERT INTO BAOCAOCONGNO VALUES (32, 8, 2021, 2, 566000, -6000, 560000)
INSERT INTO BAOCAOCONGNO VALUES (33, 9, 2021, 3, 120000, 130000, 250000)
INSERT INTO BAOCAOCONGNO VALUES (34, 10, 2021, 4, 89000, -19000, 70000)
INSERT INTO BAOCAOCONGNO VALUES (35, 11, 2021, 5, 170000, 130000, 300000)
INSERT INTO BAOCAOCONGNO VALUES (36, 12, 2021, 6, 78000, -18000, 60000)
INSERT INTO BAOCAOCONGNO VALUES (37, 1, 2022, 7, 57000, 13000, 70000)
INSERT INTO BAOCAOCONGNO VALUES (38, 2, 2022, 8, 90000, -12000, 78000)
INSERT INTO BAOCAOCONGNO VALUES (39, 3, 2022, 9, 500000, 130000, 630000)
INSERT INTO BAOCAOCONGNO VALUES (40, 4, 2022, 10, 80000, -30000, 50000)
INSERT INTO BAOCAOCONGNO VALUES (41, 5, 2022, 11, 600000, 160000, 760000)
INSERT INTO BAOCAOCONGNO VALUES (42, 6, 2022, 12, 80000, -30000, 50000)
INSERT INTO BAOCAOCONGNO VALUES (43, 7, 2022, 13, 19000, 23000, 42000)
INSERT INTO BAOCAOCONGNO VALUES (44, 8, 2022, 14, 8000, -3000, 5000)
INSERT INTO BAOCAOCONGNO VALUES (45, 9, 2022, 15, 150000, 130000, 280000)
INSERT INTO BAOCAOCONGNO VALUES (46, 10, 2022, 1, 410000, -10000, 400000)
INSERT INTO BAOCAOCONGNO VALUES (47, 11, 2022, 2, 540000, 20000, 520000)
INSERT INTO BAOCAOCONGNO VALUES (48, 12, 2022, 3, 600000, -100000, 500000)
INSERT INTO BAOCAOCONGNO VALUES (49, 1, 2023, 4, 70000, 13000, 83000)
INSERT INTO BAOCAOCONGNO VALUES (50, 2, 2023, 5, 40000, -10000, 30000)

UPDATE BAOCAOCONGNO
SET NoCuoi = NoDau + (-NoPhatSinh),
	NoPhatSinh = -NoPhatSinh
where nophatsinh < 0

CREATE TABLE [dbo].[THAMSO] (
    [Id]                       INT   NOT NULL,
    [SoLuongNhapItNhat]        INT   NULL,
    [SoLuongTonToiDaTruocNhap] INT   NULL,
    [SoLuongTonSauToiThieu]    INT   NULL,
    [SoTienNoToiDa]            FLOAT NULL,
    [SuDungQuyDinh4]           BIT   NULL,
    PRIMARY KEY CLUSTERED ([Id] ASC)
);
GO
-- không insert
INSERT INTO THAMSO VALUES (1, 150, 300, 20, 1000000, 1)
-- Tạo procedure

GO
CREATE PROCEDURE USP_Login
@username nvarchar(20), @password nvarchar(100)
AS
BEGIN
	SELECT * 
	FROM TAIKHOAN 
	WHERE Email COLLATE Latin1_General_CS_AS = @username AND MatKhau COLLATE Latin1_General_CS_AS = @password
END
GO

-- Procedure phần quản lí
--DROP PROCEDURE ThemKhachHang
GO
CREATE PROCEDURE ThemKhachHang
	@HoTenKhachHang nvarchar(30),
	@DiaChi nvarchar(100),
	@DienThoai INT,
	@Email varchar(20),
	@SoTienNo FLOAT
AS
BEGIN
	DECLARE @count int
	SELECT @count = COUNT(MaKhachHang) FROM KHACHHANG WHERE (@HoTenKhachHang = HoTenKhachHang) and (@DienThoai = DienThoai) 
	if @count = 0
	BEGIN
		DECLARE @imakh int
		SELECT @imakh = MAX(MaKhachHang) from KHACHHANG
		SET @imakh = @imakh + 1
		INSERT INTO KHACHHANG VALUES (@imakh, @HoTenKhachHang, @DiaChi,@DienThoai, @Email, @SoTienNo)
	END
END;

GO
--DROP PROCEDURE CapNhatKhachHang
GO
CREATE PROCEDURE CapNhatKhachHang
	@HoTenKhachHang nvarchar(30),
	@DiaChi nvarchar(100),
	@DienThoai INT,
	@Email varchar(20),
	@SoTienNo FLOAT
AS
BEGIN
	DECLARE @count int
	SELECT @count = COUNT(MaKhachHang) FROM KHACHHANG WHERE (@HoTenKhachHang = HoTenKhachHang) and (@DienThoai = DienThoai) 
	if @count = 1
	BEGIN
		UPDATE KHACHHANG SET HoTenKhachHang = @HoTenKhachHang, DiaChi = @DiaChi,
		DienThoai = @DienThoai, Email = @Email, SoTienNo = @SoTienNo
		WHERE @HoTenKhachHang = HoTenKhachHang AND DienThoai = @DienThoai
	END
END;

GO
--DROP PROCEDURE XoaKhachHang
GO
CREATE PROCEDURE XoaKhachHang
	@HoTenKhachHang nvarchar(50),
	@DienThoai	INT
AS
BEGIN
	DECLARE @count int
	SELECT @count = COUNT(MaKhachHang) FROM KHACHHANG WHERE (@HoTenKhachHang = HoTenKhachHang) and (@DienThoai = DienThoai) 
	if @count = 1
	BEGIN
		DELETE FROM KHACHHANG WHERE HoTenKhachHang = @HoTenKhachHang AND dienThoai = @DienThoai
	END
END;

--DROP PROCEDURE ThemSach
GO
CREATE PROCEDURE ThemSach
	@TenSach nvarchar(100),
	@TheLoai nvarchar(50),
	@TacGia nvarchar(50),
	@SoLuongTon FLOAT,
	@DonGia FLOAT
AS
BEGIN
	DECLARE @count int
	SELECT @count = COUNT(MaSach) FROM SACH WHERE (@TenSach = TenSach)
	if @count = 0
	BEGIN
		DECLARE @imasach int
		SELECT @imasach = MAX(MaSach) from SACH
		SET @imasach = @imasach + 1
		INSERT INTO SACH VALUES (@imasach , @TenSach, @TheLoai, @TacGia,@SoLuongTon, @DonGia)
	END
END;

-- TRIGGER
--Quy định 1
GO
CREATE TRIGGER TG_NhapSach
ON CHITIETPHIEUNHAP
FOR INSERT
AS
BEGIN
	DECLARE @SoLuongNhap INT, @SoLuongTon INT, @MaSach INT, @SoLuongTonToiDaTruocNhap INT, @SoLuongNhapItNhat INT
	SELECT @SoLuongNhap = inserted.SoLuongNhap, @MaSach = inserted.MaSach FROM inserted
	SELECT @SoLuongTon = SACH.SoLuongTon FROM SACH WHERE @MaSach = SACH.MaSach
	SELECT @SoLuongTonToiDaTruocNhap = SoLuongTonToiDaTruocNhap, @SoLuongNhapItNhat = SoLuongNhapItNhat FROM THAMSO
	--IF @SoLuongNhap < @SoLuongNhapItNhat OR @SoLuongTon > @SoLuongTonToiDaTruocNhap
	--BEGIN
		--ROLLBACK TRAN
		--PRINT N'Số lượng nhập không dưới '+ CAST(@SoLuongNhapItNhat AS VARCHAR) + N' sách và không nhập các sách có số lượng tồn lớn hơn ' + CAST(@SoLuongTonToiDaTruocNhap AS VARCHAR) + N' sách'
	--END
	--ELSE 
	BEGIN
		UPDATE SACH SET SACH.SoLuongTon = @SoLuongTon WHERE @MaSach = SACH.MaSach
		PRINT N'Thành công'
	END
END

GO

-- Quy định 2
CREATE TRIGGER TG_HoaDonBanSach
ON CHITIETPHIEUHOADON
FOR INSERT
AS
BEGIN
    DECLARE @MaSach INT, @MaPhieuHoaDon INT, @MaKhachHang INT, @SoTienNo FLOAT, @SoLuongBan INT, @DonGia FLOAT, @SoLuongTon INT,
			@SoLuongTonSauToiThieu INT, @SoTienNoToiDa INT

	SELECT @MaSach = MaSach, @MaPhieuHoaDon = MaPhieuHoaDon, @SoLuongBan = SoLuongBan FROM inserted
	SELECT @MaKhachHang = MaKhachHang FROM CHITIETPHIEUHOADON, PHIEUHOADON 
		WHERE CHITIETPHIEUHOADON.MaPhieuHoaDon = PHIEUHOADON.MaPhieuHoaDon
	SELECT @SoTienNo = SoTienNo FROM KHACHHANG WHERE @MaKhachHang = MaKhachHang
	SELECT @SoLuongTon = SoLuongTon, @DonGia = DonGia FROM SACH WHERE @MaSach = SACH.MaSach
	SELECT @SoLuongTonSauToiThieu = SoLuongTonSauToiThieu, @SoTienNoToiDa = SoTienNoToiDa FROM THAMSO

	IF @SoTienNo > @SoTienNoToiDa OR (@SoLuongTon - @SoLuongBan) < @SoLuongTonSauToiThieu
	BEGIN
		ROLLBACK TRAN
		PRINT N'Chỉ bán cho khách hàng không nợ quá ' + CAST(@SoTienNoToiDa AS VARCHAR) + N' và đầu sách có số lượng tồn ít nhất là ' + CAST(@SoLuongTonSauToiThieu AS VARCHAR)
	END
	ELSE
	BEGIN
		UPDATE KHACHHANG SET KHACHHANG.SoTienNo = KHACHHANG.SoTienNo + @SoLuongBan*@DonGia*1.05 WHERE @MaKhachHang = MaKhachHang
		PRINT N'Thành công'
	END
END
GO	
INSERT INTO CHITIETPHIEUHOADON VALUES (21, 2, 14, 130)

-- Quy định 4
GO
CREATE TRIGGER TG_PHIEUTHUTIEN
ON PHIEUTHUTIEN
FOR INSERT
AS
BEGIN
	DECLARE @SoTienThu FLOAT, @MaKhachHang INT, @SoTienNoCuaKhachHang FLOAT
	SELECT @SoTienThu = SoTienThu, @MaKhachHang = MaKhachHang FROM inserted
	SELECT @SoTienNoCuaKhachHang = SoTienNo FROM KHACHHANG WHERE KHACHHANG.MaKhachHang = @MaKhachHang
	--IF @SoTienThu > @SoTienNoCuaKhachHang
	--BEGIN
		--ROLLBACK TRAN
		--PRINT N'Số tiền thu không vượt quá số tiền khách hàng đang nợ'
	--END
	--ELSE
	BEGIN
		UPDATE KHACHHANG SET SoTienNo = SoTienNo - @SoTienThu WHERE KHACHHANG.MaKhachHang = @MaKhachHang
		PRINT N'Thành công'
	END
END

-- Quy định 6
---- QĐ1: Thay đổi số lượng nhập tối thiểu, lượng tồn tối thiểu trước khi nhập.
GO
CREATE PROCEDURE ThayDoiQuyDinh1
	@SoLuongNhapItNhat INT,
	@SoLuongTonToiDaTruocNhap INT
AS
BEGIN
	UPDATE THAMSO SET THAMSO.SoLuongNhapItNhat = @SoLuongNhapItNhat, THAMSO.SoLuongTonToiDaTruocNhap = @SoLuongTonToiDaTruocNhap
END;

---- QĐ2: Thay đổi tiền nợ tối đa, lượng tồn tối thiểu sau khi bán.
GO
CREATE PROCEDURE ThayDoiQuyDinh2
	@SoTienNoToiDa FLOAT,
	@SoLuongTonSauToiThieu INT
AS
BEGIN
	UPDATE THAMSO SET THAMSO.SoTienNoToiDa = @SoTienNoToiDa, THAMSO.SoLuongTonSauToiThieu = @SoLuongTonSauToiThieu
END;

---- QĐ4: Sử dụng hay không sử dụng qui định này. 
GO
CREATE PROCEDURE ThayDoiQuyDinh4
	@Check BIT
AS
BEGIN
	IF @Check = 1
	BEGIN
		ALTER TABLE PHIEUTHUTIEN ENABLE TRIGGER TG_PHIEUTHUTIEN;
		PRINT N'Sử dụng quy định 4';
	END
	ELSE
	BEGIN
		ALTER TABLE PHIEUTHUTIEN DISABLE TRIGGER TG_PHIEUTHUTIEN;
		PRINT N'Không sử dụng quy định 4';
	END;
END;

GO
CREATE FUNCTION [dbo].[ufn_removeMark] (@text nvarchar(max))
RETURNS nvarchar(max)
AS
BEGIN
	SET @text = LOWER(@text)
	DECLARE @textLen int = LEN(@text)
	IF @textLen > 0
	BEGIN
		DECLARE @index int = 1
		DECLARE @lPos int
		DECLARE @SIGN_CHARS nvarchar(100) = N'ăâđêôơưàảãạáằẳẵặắầẩẫậấèẻẽẹéềểễệếìỉĩịíòỏõọóồổỗộốờởỡợớùủũụúừửữựứỳỷỹỵýđð'
		DECLARE @UNSIGN_CHARS varchar(100) = 'aadeoouaaaaaaaaaaaaaaaeeeeeeeeeeiiiiiooooooooooooooouuuuuuuuuuyyyyydd'

		WHILE @index <= @textLen
		BEGIN
			SET @lPos = CHARINDEX(SUBSTRING(@text,@index,1),@SIGN_CHARS)
			IF @lPos > 0
			BEGIN
				SET @text = STUFF(@text,@index,1,SUBSTRING(@UNSIGN_CHARS,@lPos,1))
			END
			SET @index = @index + 1
		END
	END
	RETURN @text
END
